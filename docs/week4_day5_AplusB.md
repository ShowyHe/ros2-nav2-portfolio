# Week4 Day5 — A+B 组合实验（goal tolerance + 角速度上限）

## 目的
在 Week4 已完成 Baseline 与单参数实验（A、B/B’）的基础上，验证两个参数同时调整时是否存在“叠加收益”或“相互抵消”，并给出可复现的对照结论。

- A：放宽到达判定（goal checker）
- B：限制角速度上限（controller）

本日完成两组组合实验：
- A+B：tol=0.4，theta=0.6
- A+B’：tol=0.4，theta=0.4（由于 B 组在 theta=0.6 下效果不明显，进一步下调形成追加对照）

---

## 实验设置（固定条件）
- 地图与点位：沿用 Week1 Day6 的固定起点与 C 点目标（见 `picture/week1_day6_ABCDpoint.png`）
- 评估方式：每次仅记录 “起点→目标点” 这一段导航；回起点过程不计入统计
- 数据记录：`scripts/eval_v2_action_recovery.py` + `/behavior_tree_log` 生成 BT 证据行号范围（如可用）
- 指标：result（S/F/C）、time_sec、recovery 统计字段（如发生）

---

## 参数定义与修改点

### A：goal checker 放宽（到达判定更宽松）
- 参数：`/controller_server/general_goal_checker.xy_goal_tolerance`
- Baseline：0.25
- A 组：0.40

预期影响：
- 若 Baseline 存在“到点附近微调/徘徊”，放宽容差可减少末端修正与恢复触发概率，并降低到达耗时。

### B：限制角速度上限（转向更保守）
- 参数：`/controller_server/FollowPath.max_vel_theta`
- Baseline：1.00
- B 组：0.60
- B’ 组：0.40

预期影响：
- 对需要频繁/大角度转向的路径可能降低“急转抖动、振荡”，但也可能增加耗时。

---

## 数据文件（产出物）
- Baseline：`results/week4_baseline_runs.csv`
- A（tol=0.4）：`results/week4_A_runs.csv`
- A+B（tol=0.4, theta=0.6）：`results/week4_AplusB_tol04_theta06_runs.csv`
- A+B’（tol=0.4, theta=0.4）：`results/week4_AplusB_tol04_theta04_runs.csv`

---

## 结果汇总（20 runs / 组）
说明：当前场景整体较“容易”（成功率均为 100%），因此本日主要对比 time_sec 的分布变化。

| 组别 | 成功率 | avg_time(s) | median(s) | min(s) | max(s) |
|---|---:|---:|---:|---:|---:|
| Baseline | 20/20 | 13.139 | 12.996 | 12.471 | 14.007 |
| A（tol=0.4） | 20/20 | 12.126 | 11.861 | 11.661 | 13.980 |
| A+B（tol=0.4, theta=0.6） | 20/20 | 12.365 | 12.061 | 11.661 | 14.248 |
| A+B’（tol=0.4, theta=0.4） | 20/20 | 12.494 | 12.261 | 11.860 | 13.653 |

---

## 观察与解释

### 1) 组合并未带来明显“叠加收益”，存在一定抵消
- A 组（仅放宽 tolerance）对耗时改善更明显。
- 当引入 B/B’（限制角速度）后，平均耗时相较 A 组出现回升，但仍优于 Baseline。

解释（机制层面）：
- A 主要减少末端对齐/微调动作（更快触发到达终态），对 time_sec 的贡献直接且稳定。
- B/B’限制角速度会降低转向效率，尤其在需要调整航向的段落，可能抵消部分 A 带来的耗时收益。
- 在当前 C 点路径转向需求有限的情况下，B 的“稳定性收益”难以通过本场景的指标体现出来（例如振荡/恢复次数本就接近 0）。

### 2) 为什么“tol 变大”与“theta 变小”看起来方向相反仍合理
两者影响的系统环节不同：
- tolerance 影响“何时算到达”（终止判据）
- theta 影响“如何转向”（运动学约束）

因此组合出现“时间改善被部分抵消”是合理现象，而不是参数设置逻辑冲突。

---

## 局限性与后续建议
- 当前起点→C 点任务过于稳定（成功率与 recovery 接近上限/下限），组合参数的差异难以拉开。
- 若需要展示“成功率/恢复次数”的改进，应在 Week4 后续补充更具挑战性的目标点（例如 D 点或引入更复杂障碍/更远距离），并保持同一套评估脚本与口径。

---

## 结论
- 在固定起点→C 点场景下，A（xy_goal_tolerance 放宽）对耗时改善更明显。
- 将角速度上限下调（B/B’）在本场景中未体现额外收益，且对 A 的耗时收益存在一定抵消。
- 后续若需要验证 B 的价值，应切换至更依赖转向稳定性或更易触发振荡/恢复的路径与目标点。
